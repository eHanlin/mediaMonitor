//author: sparrow.jang
//verion: 0.0.7
(function(){var t,e,n,i,s,r;t=function(){function t(t,e,n){this.el=t,this.scale=null!=e?e:100,this.listenCB=n,this.addEvent_(this.el,"play",this),this.addEvent_(this.el,"pause",this),this.addEvent_(this.el,"seeking",this),this.addEvent_(this.el,"seeked",this),this.addEvent_(this.el,"timeupdate",this),this.addEvent_(this.el,"ended",this),this.isEnabledSeeking_="onseeking"in this.el||"onseeked"in this.el||/(ipad|iphone)/i.test(navigator.userAgent)&&/Version\/8/i.test(navigator.userAgent),this.el.duration&&this.setDuration_(this.el.duration),this.addEvent_(this.el,"loadedmetadata",this)}return t.prototype.addEvent_=function(t,e,n,i){return t.addEventListener(e,n,!!i)},t.prototype.removeEvent_=function(t,e,n,i){return t.removeEventListener(e,n,!!i)},t.prototype.setDuration_=function(t){return this.duration_=t},t.prototype.handleEvent=function(t){var e,n,i;return n=t.type,e=n.substr(0,1),i=n.substr(1,n.length-1),this["on"+e.toUpperCase()+i](t)},t.prototype.resetStartTime_=function(t){return this.startTime_=t},t.prototype.destroy=function(){return this.removeEvent_(this.el,"play",this),this.removeEvent_(this.el,"pause",this),this.removeEvent_(this.el,"seeking",this),this.removeEvent_(this.el,"seeked",this),this.removeEvent_(this.el,"timeupdate",this)},t.prototype.onPlay=function(){return this.isEnablePlaying=!0,this.resetStartTime_(this.el.currentTime)},t.prototype.onPause=function(){return this.isEnablePlaying=!1,this.clearLastStatus_()},t.prototype.onEnded=function(){return Math.round(this.el.currentTime)===Math.round(this.duration_)?this.onScaleChange():void 0},t.prototype.onSeeking=function(){return this.isEnablePlaying=!1,this.clearLastStatus_()},t.prototype.onSeeked=function(){return this.isEnablePlaying=!0,this.resetStartTime_(this.el.currentTime)},t.prototype.onLoadedmetadata=function(){return this.setDuration_(this.el.duration),this.clearLastStatus_()},t.prototype.startTime_=0,t.prototype.setLastStatus_=function(t,e){return this.lastStatus_={startScale:t,endScale:e}},t.prototype.getLastStatus_=function(){return this.lastStatus_},t.prototype.clearLastStatus_=function(){return this.lastStatus_=null},t.prototype.onScaleChange=function(){var t,e,n,i,s;return this.isEnabledSeeking_?(n=this.getLastStatus_(),s=n?n.endScale:parseInt(this.startTime_*this.scale/this.duration_),t=this.el.currentTime,e=parseInt(t*this.scale/this.duration_),!this.listenCB||n&&e===n.endScale||this.listenCB({startScale:s,endScale:e}),this.setLastStatus_(s,e)):(i=parseInt(this.el.currentTime*this.scale/this.duration_),i!==this.lastScale_&&this.listenCB({startScale:i,endScale:i}),this.lastScale_=i)},t.prototype.onTimeupdate=function(){return this.setDuration_(this.el.duration),this.isEnablePlaying&&!this.el.paused?this.onScaleChange():void 0},t}(),i={url:function(t){var e,n;n=[];for(e in t)n.push(""+e+"="+t[e]);return n.join("&")},json:function(t){return JSON.stringify(t)}},n=function(t){return function(e,n,s){var r,a,o,u,h;return null==s&&(s="url"),h=new XMLHttpRequest,u="get"===t.toLowerCase(),a=i[s](n),u?(o="json"===s?"data=":"",r=""+r+"?"+o+a):r=e,h.open(t,e,!0),u?h.send():h.send(a)}},e={get:n("get"),post:n("post"),put:n("put")},r={isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},s=function(){return{detect:function(n,i){var s,a;return null==i&&(i={}),i&&"object"==typeof i.listenCB?(a=i.listenCB,s=function(t){var n,i,s,o,u;if(e[a.name](a.url,t,a.dataType),i=a.otherCBs,i&&r.isArray(i)){for(u=[],s=0,o=i.length;o>s;s++)n=i[s],u.push(n(t));return u}}):s=i.listenCB,new t(n,i.scale,s)}}}(),"undefined"!=typeof module&&(module.exports=s),"undefined"!=typeof window&&(window.mediaMonitor=s)}).call(this);